#!/usr/bin/make -f

DEB_TAR_SRCDIR                  := freefem++-2.7
DEB_AUTO_CLEANUP_RCS            := yes


DEB_MAKE_CLEAN_TARGET    := clean
#DEB_MAKE_BUILD_TARGET    := default
DEB_COMPRESS_EXCLUDE     := .pdf .svn

include /usr/share/cdbs/1/class/autotools.mk
include /usr/share/cdbs/1/rules/debhelper.mk
include /usr/share/cdbs/1/rules/tarball.mk
include /usr/share/cdbs/1/rules/simple-patchsys.mk


DEB_SRCDIR 			:= $(CURDIR)
DEB_BUILDDIR 			:= $(DEB_SRCDIR)
DEB_CONFIGURE_SCRIPT		:= $(DEB_SRCDIR)/configure

#DEB_MAKE_ENVVARS    := -j2

DEB_CONFIGURE_EXTRA_FLAGS := \
  --enable-optim \
  --enable-generic\
  --disable-pdf\
  --with-mpi=yes --includedir=/usr/lib/mpich/include/mpi2c++

clean::
	-rm DOC/cpfigs/*
	-rm examples++-load/*.so examples++-load/*.o examples++-load/include/*

pre-build::
	-(cd examples++-load/include && for i in ../../src/fflib/*.h*; do cp $$i .; done)
	-(cd examples++-load/include && for i in ../../src/femlib/*.h*; do cp $$i .; done)
	-(cd examples++-load/include && for i in ../../src/Graphics/*.h*; do cp $$i .; done)
	-(cd examples++-load/include && for i in ../../*.h; do cp $$i .; done)
	-(cd examples++-load/include && cp ../../config.h .)

build/freefem++::
	cd DOC && make freefem++doc.pdf

install/freefem++::
	(cd debian/freefem++/usr/bin/ && mv FreeFem++ freefem++)
	(cd debian/freefem++/usr/bin/ && mv FreeFem++-nw  freefem++-nw)
	(cd debian/freefem++/usr/bin/ && mv FreeFem++-glx freefem++-glx)
	(cd debian/freefem++/usr/bin/ && mv FreeFem++-ide freefem++-ide)
	(cd debian/freefem++/usr/bin/ && mv FreeFem++-cs  freefem++-cs)
	(cd debian/freefem++/usr/bin/ && mv FreeFem++-mpi freefem++-mpi)
	(cd debian/freefem++/usr/bin/ && mv FreeFem++-client freefem++-client)
	(cd debian/freefem++/usr/bin/ && mv FreeFem++-server freefem++-server)
#	find debian/freefem++ -name ".svn" -type d  | xargs rm -rf
